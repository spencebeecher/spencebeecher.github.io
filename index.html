<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holiday Bingo</title>
    <style>
        /* Add some basic styling width: 100%;*/
        table {
            border-collapse: collapse;
            
            max-width: 200px;
            margin: auto;
            margin-left: 0; /* Align table to the left */
            padding-left: 3px; /* Add padding to the left */
            padding-right: 3px; /* Add padding to the right */
            table-layout: fixed; /* Ensure equal width for all cells */
        }
        /* Add media query for desktop */
        @media (min-width: 768px) {
            table {
                max-width: 300px;
            }
        }
        td {
            border: 1px solid #000;
            width: 20%; /* Ensure equal width for all cells */
            text-align: center;
            vertical-align: middle;
            /*font-size: 4vw;*/
            border-right: 1px solid #000;
        }
        .marked_green {
            background-color: green;
        }
        .marked_red {
            background-color: red;
        }
    </style>
</head>
<body>
    <h1>Holiday Bingo</h1>
    <button id="generate-board">Regenerate Bingo</button>
    <table id="bingo-board">
        <!-- ...existing code... -->
        <!-- Generate a 5x5 Bingo board -->
        <tr>
            <td>B</td><td>I</td><td>N</td><td>G</td><td>O</td>
        </tr>
        <!-- ...existing code... -->
        <!-- Add rows for numbers -->
        <tr>
            <td class="cell">1</td><td class="cell">16</td><td class="cell">31</td><td class="cell">46</td><td class="cell">61</td>
        </tr>
        <tr>
            <td class="cell">2</td><td class="cell">17</td><td class="cell">32</td><td class="cell">47</td><td class="cell">62</td>
        </tr>
        <tr>
            <td class="cell">3</td><td class="cell">18</td><td class="cell">33</td><td class="cell">48</td><td class="cell">63</td>
        </tr>
        <tr>
            <td class="cell">4</td><td class="cell">19</td><td class="cell">34</td><td class="cell">49</td><td class="cell">64</td>
        </tr>
        <tr>
            <td class="cell">5</td><td class="cell">20</td><td class="cell">35</td><td class="cell">50</td><td class="cell">65</td>
        </tr>
    </table>
    <script>
        function getTropes() {
            const tropes = [
                "Big City Girl Finds Small-Town Love",
                "Attractive Widower/Devorcee",
                "Family Business Needs Saving",
                "Perfect Holiday Festival",
                "Workaholic Learns Holiday Spirit",
                "Small-Town Charm Wins Over Cynic",
                "Overachiever Learns to Relax",
                "Small Town with Big Traditions",
                "Snowed-In somewhere cozy",
                "Sassy Friend Loves Christmas",
                "Snow Globe",
                
                "Grumpy Boss Finds Holiday Joy",
                "Inheriting a Christmas Cottage",
                "Miracle Saves the Holidays",
                "Special Ornament",
                "Big Family Gathering",
                "Adorable Dog/Cat in a Santa Hat",
                "Romantic Carriage Ride in Town",
                "Epic Christmas Decor Showdown",
                "Countdown Clock to Holiday Love",
                "Reference to other chrismas movie",
                "Snowfall at the Perfect Moment",
                "Mistletoe Kiss",
                "Holiday Schedule Chaos",
                "Big Secret Unveiled",
                "Small Business Saved by Miracle",
                "Hometown Hero Restores Spirit",
                "City Slicker Meets Rustic Charm",
                "Volunteer Event",
                "Grandparent Shares Timeless Wisdom",
                "Clumsy Yet Sweet Helper",
                "Festive Town Parade",
                "Rivalry Over Decorations",
                "Magic Kiss on Christmas Eve",
                
                "Tree Lighting Ceremony",
                "Last-Minute Dash for Holiday Cheer",
                "Enemies Fall in Love at Christmas",
                "Town Legend of Christmas Magic",
                "Holiday Market",
                "Family Heirloom",
                "Assistant Finally Gets Their Moment",
                "Christmas Engagement",
                "Perfect Small-Town Boyfriend",
                "City Girl canâ€™t do small town things",
                "Secret Santa Gift with Meaning",
                "Big City Plans Fall Apart",
                "Lost Pet Found",
                "Fake Dating Leads to Real Love",
                
                "Holiday Photoshoot",
                "Small-Town Festival",
                "Surprise Family Visit",
                "Holiday Costume Disaster",
                "Petty Argument Ends in Love",
                "Child Helps Adults Believe Again",
                "Snowball Fight",
                "Tree Farm",
                "Reindeer",
                "Hidden Talent",
                "Holiday Concert",
                "Holiday Grump",
                "Santa Stand-In",
                "Holiday Workaholic",
                "Overbearing Parent/Relative",
                "Cute Kid",
                "Perfect Love Interest",
                "City Slicker",
                "Mischievous Elf",
                "Cynical Teen",
                "Grumpy Boss",
                "Wise Grandparent",
                "Small Town with Big Christmas Spirit",
                "Family Cabin",
                "Busy Department Store",
                
                "Cozy Bakery",
                
                "Enchanted Workshop",
                "Snowy Forest",
                "Over-the-Top Holiday House",
                "Big City at Christmas",
                "'Save Christmas' Mission",
                "Mistaken Identity",
                "Holiday Bet/Dare",
                "Christmas Competition",
                "Return Home for the Holidays",
                "Magical Wish",
                "Holiday Scrooge",
                "Holiday Makeover",
                "Romantic Mix-Up",
                "Christmas Heist",
                "Last-Minute Gift Dash",
                "Snowed-In Romance",
                "Holiday Proposal",
                "Dcovery of True Meaning of Christmas",
                "Redemption and Forgiveness",
                "Overcoming Holiday Cynicism",
                "Generational Holiday Conflict",
                "Spirit of Giving",
                "Snowy Nights",
                "Mistletoe",
                "Caroling Scenes",
                "Twinkling Lights",
                "Ugly Christmas Sweaters",
                "Festive Food Feasts",
                "Christmas Markets",
                "Special Ornament",
                "Naughty or Nice List/Reference",
                "Snow Globe",
                "Over-the-Top Neighbors",
                "Magical Creatures",
                "Ornaments",
                "Stockings",
                "Christmas Lights",
                "Candy Canes",
                "Poinsettias",
                "Snow Globes",
                "Nativity Scenes",
                "Santa Claus",
                "Reindeer",
                "Sleighs",
                "Snowmen",
                "Elves",
                "Gingerbread Houses",
                "Eggnog",
                "Hot Cocoa",
                "Christmas Cookies",
                "Yule Log (Cake) or Fruit Cake",
                "Fire Roaring in the Fireplace",
                "Gift Wrapping Paper",
                "Christmas Morning",
                "Christmas Carols",
                "Holiday Movies",
                "Christmas Villages",
                "Ugly Christmas Sweaters",
                "Snowflakes",
                "Icicles",
                "Christmas Bells",
                "Candy Cane Stripes",
                "Santa Hats",
                "Winter Scarves",
                "Holiday Pajamas",
                "North Pole",
                "Christmas Elves",
                "Christmas Parties",
                "Gift Exchanges",
                "Caroling",
                "Winter Wonderlands",
                "Christmas Parades",
                "Snowball Fights",
                "Icicle Lights",
                "Holiday Mugs",
                "Nutcracker",
                "Candy Canes",
                "French Horn in Soundtrack",
                "Sleigh Bells Ringing",
                "Christmas Stockings",
                "Festive Table Settings",
                "North Pole Signs",
                "Holiday Baking",
                "Festive Wreaths",
                "Ice Skating",
                "Holiday Classics Music",
                "Holiday Magic",
            ];

            return [...new Set(tropes)];
        }

        function seededShuffle(array, s) {
            var seed = s + 1;

            for (let i = array.length - 1; i > 0; i--) {
                var x = Math.sin(seed++) * 10000;
                x = x - Math.floor(x);
                const j = Math.floor(x * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function hashString(str) {
            let hash = 0;
            for (let i = 0, len = str.length; i < len; i++) {
                let chr = str.charCodeAt(i);
                hash = (hash << 5) - hash + chr;
                hash |= 0; // Convert to 32bit integer
            }
            return hash;
        }

        function setCookie(name, value, days) {
            const d = new Date();
            d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = "expires=" + d.toUTCString();
            document.cookie = name + "=" + value + ";" + expires + ";path=/";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        function generateRandomUserId() {
            return 'user_' + Math.random().toString(36).substr(2, 9);
        }

        function getOrCreateUserId(reset) {
            let userId = getCookie('user-id');
            if (!userId || reset) {
                userId = generateRandomUserId();
                setCookie('user-id', userId, 365);
            }
            return userId;
        }

        function generateBoard() {
            const userId = getOrCreateUserId();
            console.log('User ID:', userId);
            
            const seed = hashString(userId);
            christmasTropes = getTropes();
            seededShuffle(christmasTropes, seed);

            const cells = document.querySelectorAll('.cell');
            cells.forEach((cell, index) => {
                
                if (index < christmasTropes.length) {
                    cell.textContent = christmasTropes[index];
                    if (index === 12) {
                        cell.textContent = 'FREE';
                        cell.classList.add('marked_green');
                    }
                }
            });
        }

        function saveCellColors() {
            console.log('save cell colors');
            const cells = document.querySelectorAll('#bingo-board td');
            const colors = Array.from(cells).map(cell => cell.classList.contains('marked_green') ? 'green' : '');
            setCookie('cell-colors', JSON.stringify(colors), 7);
        }

        function loadCellColors() {
            console.log('load cell colors');
            const colors = JSON.parse(getCookie('cell-colors') || '[]');
            const cells = document.querySelectorAll('#bingo-board td');
            cells.forEach((cell, index) => {
                if (colors[index] === 'green') {
                    cell.classList.add('marked_green');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            generateBoard();
            loadCellColors();
        });

        document.getElementById('generate-board').addEventListener('click', async () => {
            console.log('generate board click');
            getOrCreateUserId(true);
            const cells = document.querySelectorAll('#bingo-board td');
            cells.forEach((cell, index) => {
                cell.classList.remove('marked_green');
            });
            generateBoard();
            saveCellColors();
            //loadCellColors();
        });

        document.querySelectorAll('#bingo-board td').forEach(cell => {
            cell.addEventListener('click', () => {
                console.log('cell click');
                if (cell.classList.contains('marked_green')) {
                    cell.classList.remove('marked_green');
                } else {
                    cell.classList.add('marked_green');
                }
                saveCellColors();
            });
        });

    </script>
</body>
</html>
