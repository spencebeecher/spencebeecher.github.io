<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holiday Bingo</title>
    <style>
        /* Add some basic styling width: 100%;*/
        table {
            border-collapse: collapse;
            
            max-width: 200px;
            margin: auto;
            margin-left: 0; /* Align table to the left */
        }
        /* Add media query for desktop */
        @media (min-width: 768px) {
            table {
                max-width: 300px;
            }
        }
        td {
            border: 1px solid #000;
            width: 20%;
            text-align: center;
            vertical-align: middle;
            /*font-size: 4vw;*/
            border-right: 1px solid #000;
        }
        .marked_green {
            background-color: green;
        }
        .marked_red {
            background-color: red;
        }
    </style>
</head>
<body>
    <h1>Holiday Bingo</h1>
    <input type="text" id="seed-input" placeholder="Movie Name">
    <button id="generate-board">Create Bingo</button>
    <table id="bingo-board">
        <!-- ...existing code... -->
        <!-- Generate a 5x5 Bingo board -->
        <tr>
            <td>B</td><td>I</td><td>N</td><td>G</td><td>O</td>
        </tr>
        <!-- ...existing code... -->
        <!-- Add rows for numbers -->
        <tr>
            <td class="cell">1</td><td class="cell">16</td><td class="cell">31</td><td class="cell">46</td><td class="cell">61</td>
        </tr>
        <tr>
            <td class="cell">2</td><td class="cell">17</td><td class="cell">32</td><td class="cell">47</td><td class="cell">62</td>
        </tr>
        <tr>
            <td class="cell">3</td><td class="cell">18</td><td class="cell">33</td><td class="cell">48</td><td class="cell">63</td>
        </tr>
        <tr>
            <td class="cell">4</td><td class="cell">19</td><td class="cell">34</td><td class="cell">49</td><td class="cell">64</td>
        </tr>
        <tr>
            <td class="cell">5</td><td class="cell">20</td><td class="cell">35</td><td class="cell">50</td><td class="cell">65</td>
        </tr>
    </table>
    <script>
        function getTropes(){
            return [
            "Big City Girl Finds Small-Town Love",
            "Handsome Widower with a Secret",
            "Matchmaker Brings Christmas Magic",
            "Family Business Needs Saving",
            "Perfect Holiday Festival Drama",
            "Workaholic Learns Holiday Spirit",
            "Small-Town Charm Wins Over Cynic",
            "Christmas Tree Lighting Sparks Romance",
            "Old Love Rekindled in the Snow",
            "Mystery Letter Changes Everything",
            "Holiday Wedding Nearly Fails",
            "Overachiever Learns to Relax",
            "Small Town with Big Traditions",
            "Snowed-In at the Cozy Inn",
            "Sassy Friend Loves Christmas",
            "Magical Snow Globe Brings Hope",
            "Holiday Baking Contest Rivalry",
            "Secret Family Recipe Saves the Day",
            "Grumpy Boss Finds Holiday Joy",
            "Inheriting a Christmas Cottage",
            "Corporate Scrooge Learns to Love",
            "The Secret Christmas Prince",
            "Miracle Saves the Holidays",
            "Special Ornament Brings Luck",
            "Family Reunion with Hidden Drama",
            "Craft Fair Sparks Competition",
            "Adorable Dog in a Santa Hat",
            "Romantic Carriage Ride in Town",
            "Epic Christmas Decor Showdown",
            "Countdown Clock to Holiday Love",
            "Movie-Inspired Holiday Love Story",
            "Mysterious Guest Brings Joy",
            "Snowfall at the Perfect Moment",
            "Mistletoe Kiss Mix-Up",
            "Holiday Schedule Chaos",
            "Charity Gala Saves Christmas",
            "Big Secret Unveiled on Christmas",
            "Small Business Saved by Miracle",
            "Hometown Hero Restores Spirit",
            "City Slicker Meets Rustic Charm",
            "Volunteer Event Sparks Love",
            "Grandparent Shares Timeless Wisdom",
            "Clumsy Yet Sweet Helper",
            "Festive Town Parade Sparks Joy",
            "Sweet Shop Owner Finds Love",
            "Sibling Rivalry Over Decorations",
            "Snowstorm Strands Star-Crossed Lovers",
            "Magic Kiss on Christmas Eve",
            "Unexpected Partner Saves Holiday",
            "Cherished Holiday Tradition Returns",
            "Last-Minute Dash for Holiday Cheer",
            "Enemies Fall in Love at Christmas",
            "Angel Guides the Protagonist",
            "Town Legend of Christmas Magic",
            "Wish Upon a Star Comes True",
            "Holiday Market Sparks Romance",
            "Family Heirloom Holds the Key",
            "Assistant Finally Gets Their Moment",
            "Christmas Engagement Almost Ruined",
            "Perfect Small-Town Boyfriend",
            "City Girl Can’t Chop a Tree",
            "Child Brings Two Adults Together",
            "Holiday Train Ride Sparks Love",
            "Overbooked Calendar Leads to Chaos",
            "Town Baker Becomes a Hero",
            "Widowed Parent Finds Hope Again",
            "Secret Santa Gift with Meaning",
            "Big City Plans Fall Apart",
            "Stranger Brings Christmas Spirit",
            "Lost Pet Found on Christmas Eve",
            "Fake Dating Leads to Real Love",
            "Child’s Wish Brings Family Together",
            "Rival Bakeries Find Common Ground",
            "Lost Gift Returns at the Right Time",
            "Holiday Photoshoot Sparks Love",
            "Boss Becomes a Better Person",
            "Angel Ornament Brings Magic",
            "Small-Town Festival Saves the Day",
            "Surprise Family Visit Changes Plans",
            "Holiday Costume Disaster Creates Laughs",
            "Petty Argument Ends in Love",
            "Mysterious Shopkeeper Changes Lives",
            "Child Helps Adults Believe Again",
            "Snowball Fight Turns Romantic",
            "Old Toy Holds a Big Secret",
            "Tree Farm Love Story Blossoms",
            "Reindeer Mishap Creates Chaos",
            "Hidden Talent Saves the Day",
            "Holiday Concert Unites the Town",
            "The Holiday Grump",
            "The Santa Stand-In",
            "The Holiday Workaholic",
            "The Mysterious Stranger",
            "The Overbearing Parent/Relative",
            "The Cute Kid",
            "The Perfect Love Interest",
            "The City Slicker",
            "The Mischievous Elf",
            "The Cynical Teen",
            "The Grumpy Boss",
            "The Wise Grandparent",
            "The Small Town with Big Christmas Spirit",
            "The Family Cabin",
            "The Busy Department Store",
            "The Christmas Tree Farm",
            "The Cozy Bakery",
            "The Ice Skating Rink",
            "The Enchanted Workshop",
            "The Snowy Forest",
            "The Over-the-Top Holiday House",
            "The Big City at Christmas",
            "The 'Save Christmas' Mission",
            "The Mistaken Identity",
            "The Holiday Bet/Dare",
            "The Christmas Competition",
            "The 'Return Home for the Holidays' Story",
            "The Magical Wish",
            "The 'Scrooge' Arc",
            "The Holiday Makeover",
            "The Romantic Mix-Up",
            "The Christmas Heist",
            "The Holiday Rescue",
            "The Last-Minute Gift Dash",
            "The Snowed-In Romance",
            "The Holiday Proposal",
            "The Power of Belief",
            "The True Meaning of Christmas",
            "Redemption and Forgiveness",
            "Overcoming Holiday Cynicism",
            "Generational Holiday Conflict",
            "The Spirit of Giving",
            "Snowy Nights",
            "Mistletoe Moments",
            "Caroling Scenes",
            "Twinkling Lights",
            "The Perfect Christmas Morning",
            "Ugly Christmas Sweaters",
            "Festive Food Feasts",
            "Christmas Markets",
            "The Special Ornament",
            "The Naughty or Nice List",
            "The Magical Snow Globe",
            "The Christmas Star",
            "The Lost Letter to Santa",
            "Holiday Hijinks",
            "The Overbooked Holiday",
            "The Reluctant Santa Suit",
            "Over-the-Top Neighbors",
            "Magical Creatures",
            "Time Loops",
            "Christmas Spirits"
            ];
        }
        

        function seededShuffle(array, s) {
            console.log(s);
            var seed = s + 1;

            for (let i = array.length - 1; i > 0; i--) {
                var x = Math.sin(seed++) * 10000;
                x = x - Math.floor(x);
                const j = Math.floor(x * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function hashString(str) {
            let hash = 0;
            for (let i = 0, len = str.length; i < len; i++) {
                let chr = str.charCodeAt(i);
                hash = (hash << 5) - hash + chr;
                hash |= 0; // Convert to 32bit integer
            }
            return hash;
        }

        function setCookie(name, value, days) {
            const d = new Date();
            d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = "expires=" + d.toUTCString();
            document.cookie = name + "=" + value + ";" + expires + ";path=/";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        function generateRandomUserId() {
            return 'user_' + Math.random().toString(36).substr(2, 9);
        }

        function getOrCreateUserId() {
            let userId = getCookie('user-id');
            if (!userId) {
                userId = generateRandomUserId();
                setCookie('user-id', userId, 365);
            }
            return userId;
        }

        function generateBoard() {
            const userId = getOrCreateUserId();
            console.log('User ID:', userId);
            const seedString = document.getElementById('seed-input').value || "Enter in your movie name";
            setCookie('seed-input', seedString, 7);
            const seed = hashString(seedString+userId);
            console.log(seed);
            christmasTropes = getTropes();
            seededShuffle(christmasTropes, seed);

            const cells = document.querySelectorAll('.cell');
            cells.forEach((cell, index) => {
                if (index < christmasTropes.length) {
                    cell.textContent = christmasTropes[index];
                }
            });
        }

        function saveCellColors() {
            const cells = document.querySelectorAll('#bingo-board td');
            const colors = Array.from(cells).map(cell => cell.classList.contains('marked_green') ? 'green' : '');
            setCookie('cell-colors', JSON.stringify(colors), 7);
        }

        function loadCellColors() {
            const colors = JSON.parse(getCookie('cell-colors') || '[]');
            const cells = document.querySelectorAll('#bingo-board td');
            cells.forEach((cell, index) => {
                if (colors[index] === 'green') {
                    cell.classList.add('marked_green');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const savedSeed = getCookie('seed-input');
            
            if (savedSeed) {
                document.getElementById('seed-input').value = savedSeed;
            }
            generateBoard();
            loadCellColors();
        });

        document.getElementById('generate-board').addEventListener('click', async () => {
            generateBoard();
        });

        document.querySelectorAll('#bingo-board td').forEach(cell => {
            cell.addEventListener('click', () => {
                if (cell.classList.contains('marked_green')) {
                    cell.classList.remove('marked_green');
                } else {
                    cell.classList.add('marked_green');
                }
                saveCellColors();
            });
        });

    </script>
</body>
</html>
